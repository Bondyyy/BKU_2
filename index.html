<!DOCTYPE html>
<html>
  <head>
    <title>AI Defect Detection</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="page">
      <div class="box">
        <h1 class="title">Tải ảnh lên để kiểm tra sản phẩm</h1>
        <input
          type="file"
          id="fileInput"
          accept="image/*"
          onchange="previewImage()"
        />
        <br />
        <img id="preview" src="#" alt="Ảnh xem trước" style="display: none" />
        <br />
        <button onclick="uploadFile()" class="button">Dự đoán</button>
        <p id="result"></p>
      </div>
    </div>

    <script>
      function previewImage() {
        const fileInput = document.getElementById("fileInput");
        const preview = document.getElementById("preview");

        if (fileInput.files && fileInput.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(fileInput.files[0]);
        }
      }

      function uploadFile() {
        const fileInput = document.getElementById("fileInput");
        if (!fileInput.files[0]) {
          alert("Vui lòng chọn một ảnh");
          return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        fetch("/predict", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById(
              "result"
            ).innerHTML = `Kết quả: ${data.predicted_class} <br>
                     Def: ${data.prob_def}% | OK: ${data.prob_ok}%`;
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
